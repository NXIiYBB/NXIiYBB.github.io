<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Postcard Maker üíå</title>
  <style>
    :root{
      --bg:#f7f7fb;
      --ink:#1f2937;
      --brand:#ff96b5;
      --brand-2:#9dd6ff;
      --pill:#ffffffcc;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", sans-serif;
      background: linear-gradient(135deg,#fff7fb,#f2fbff);
      color:var(--ink);
    }
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(180%) blur(8px);
      background:linear-gradient(180deg, #ffffffdd, #ffffff88);
      border-bottom:1px solid #eee;
    }
    .wrap{max-width:980px; margin:0 auto; padding:16px;}
    .title{display:flex; gap:12px; align-items:center;}
    .title h1{font-size:20px; margin:0}
    .toolbar{display:flex; flex-wrap:wrap; gap:8px; margin-top:8px}
    .btn{appearance:none; border:0; padding:10px 14px; border-radius:999px; background:var(--pill);
      box-shadow:0 2px 8px rgba(0,0,0,.06); cursor:pointer; font-size:14px}
    .btn.primary{background:var(--brand); color:#fff;}
    .btn.secondary{background:#fff;}
    .btn:active{transform:translateY(1px)}
    .picker{display:flex; align-items:center; gap:8px; background:#fff; padding:8px 12px; border-radius:14px; box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .picker input[type="text"]{border:0; outline:none; font-size:14px; padding:8px 10px; background:#f6f7fb; border-radius:10px; min-width:180px}
    .picker input[type="range"]{width:120px}
    .stickers{display:flex; gap:6px; flex-wrap:wrap}
    .sticker-btn{font-size:18px; padding:6px 10px}

    /* Canvas stage */
    .stage-wrap{display:flex; justify-content:center; align-items:center; padding:16px}
    .stage{position:relative; aspect-ratio:9/16; width:min(92vw, 420px); background:#fafafa; border-radius:24px; box-shadow:0 10px 30px rgba(0,0,0,.08); overflow:hidden}
    canvas{width:100%; height:100%; display:block}

    footer{padding:24px; text-align:center; color:#6b7280; font-size:12px}
    .hint{font-size:12px; color:#6b7280}

    

  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <div style="width:32px;height:32px;background:linear-gradient(135deg,var(--brand),var(--brand-2));border-radius:10px;display:grid;place-items:center;color:#fff;">üíå</div>
        <h1>Postcard Maker ‚Äî ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö IG Story</h1>
      </div>
      <div class="toolbar">
        <div class="picker" title="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î">
          <span>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
          <input id="textInput" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô ‡πÜ ..." maxlength="80" />
          <label class="hint">‡∏Ç‡∏ô‡∏≤‡∏î</label>
          <input id="textSize" type="range" min="24" max="120" value="48" />
          <button class="btn secondary" id="addText">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
        </div>
        <div class="picker" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå">
          <span>‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå</span>
          <div class="stickers" id="stickers"></div>
          <button class="btn secondary" id="addRandomSticker">‡∏™‡∏∏‡πà‡∏°‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå</button>
        </div>
        <div class="picker" title="‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á">
          <button class="btn" id="shuffleBg">‡∏™‡∏∏‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
          <button class="btn" id="togglePattern">‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î/‡∏õ‡∏¥‡∏î‡∏•‡∏≤‡∏¢</button>
        </div>
        <div class="picker" title="‡∏Å‡∏≤‡∏£‡πå‡∏î">
          <button class="btn" id="centerAll">‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á</button>
          <button class="btn" id="clearItems">‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°</button>
          <button class="btn primary" id="downloadBtn">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î 1080√ó1920</button>
        </div>
      </div>
    </div>
  </header>

  <main class="stage-wrap">
    <div class="stage">
      <canvas id="card" width="1080" height="1920" aria-label="‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î"></canvas>
    </div>
  </main>

  <footer>
    ‡πÅ‡∏ï‡∏∞/‡∏•‡∏≤‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏ ‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏á‡∏ô‡∏¥‡πâ‡∏ß‡∏û‡∏¥‡∏ô‡∏ä‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏π‡∏° (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) ‚Ä¢ ‡πÅ‡∏ï‡∏∞‡∏™‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Ä¢ ‡∏´‡∏°‡∏∏‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏° A/D ‡∏ã‡∏π‡∏°‡∏î‡πâ‡∏ß‡∏¢ W/S
  </footer>

  <script>
    // ====== State ======
    const canvas = document.getElementById('card');
    const ctx = canvas.getContext('2d');
    const DPR = Math.max(1, window.devicePixelRatio || 1);

    // Ensure crisp on high-DPI when downloading (we keep internal at 1080x1920 already)

    const BG_GRADIENTS = [
      ['#FFD1DC','#E0F7FF'],
      ['#FFE6A7','#B8E1FF'],
      ['#E8D6FF','#FDE2E4'],
      ['#C9F0FF','#FEE1F3'],
      ['#E0FFE4','#FFF0F6'],
    ];
    let bgIndex = Math.floor(Math.random()*BG_GRADIENTS.length);
    let showPattern = true;

    const EMOJIS = ['ü•∞','üå∏','üåà','üêª','üíñ','‚ú®','üçÄ','üßã','üçì','üß∏','üí´','üåº','‚òÅÔ∏è','üê£','üéÄ'];

    const items = []; // {type:'text'|'sticker', text, emoji, x,y, scale, rot, size, alignCenter}
    let activeIndex = -1;

    // ====== Helpers ======
    function rand(min,max){return Math.random()*(max-min)+min}
    function centerPos(){ return {x: canvas.width/2, y: canvas.height*0.45}; }

    function addTextItem(text, size){
      if(!text) return;
      items.push({type:'text', text, x:centerPos().x, y:centerPos().y, scale:1, rot:0, size:size||48, alignCenter:true});
      activeIndex = items.length-1;
      draw();
    }
    function addSticker(emoji){
      items.push({type:'sticker', emoji, x: rand(240, canvas.width-240), y: rand(360, canvas.height-360), scale: rand(0.8,1.3), rot: rand(-0.2,0.2)});
      activeIndex = items.length-1;
      draw();
    }

    // ====== Drawing ======
    function drawBackground(){
      const [c1,c2]=BG_GRADIENTS[bgIndex];
      const grd=ctx.createLinearGradient(0,0, canvas.width, canvas.height);
      grd.addColorStop(0,c1); grd.addColorStop(1,c2);
      ctx.fillStyle=grd; ctx.fillRect(0,0,canvas.width,canvas.height);
      if(showPattern){
        const step=120; ctx.globalAlpha=0.15; ctx.fillStyle='#ffffff';
        for(let y=step/2;y<canvas.height;y+=step){
          for(let x=step/2;x<canvas.width;x+=step){
            ctx.beginPath(); ctx.arc(x,y,6,0,Math.PI*2); ctx.fill();
          }
        }
        ctx.globalAlpha=1;
      }
      // white frame
      const m=48; ctx.strokeStyle='rgba(255,255,255,.8)'; ctx.lineWidth=12; ctx.strokeRect(m,m, canvas.width-2*m, canvas.height-2*m);
    }

    function drawItems(){
      items.forEach((it, i)=>{
        ctx.save();
        ctx.translate(it.x, it.y);
        ctx.rotate(it.rot||0);
        ctx.scale(it.scale||1, it.scale||1);
        if(it.type==='text'){
          ctx.font = `600 ${it.size||48}px system-ui, \"Noto Color Emoji\", emoji`;
          ctx.fillStyle = '#1f2937';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          wrapText(it.text, 800, it.size*1.2);
        } else {
          ctx.font = `${160}px \"Noto Color Emoji\", system-ui`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(it.emoji, 0, 0);
        }
        ctx.restore();
        // active highlight
        if(i===activeIndex){
          ctx.save();
          ctx.strokeStyle = 'rgba(31,41,55,.6)';
          ctx.setLineDash([12,8]);
          ctx.lineWidth=4; ctx.strokeRect(it.x-140, it.y-140, 280, 280);
          ctx.restore();
        }
      })
    }

    function wrapText(text, maxWidth, lineHeight){
      const words = text.split(' ');
      let line = '', y=0;
      const lines=[];
      for(let w of words){
        const test = line? line+" "+w : w;
        if(ctx.measureText(test).width > maxWidth){
          lines.push(line); line = w;
        }else line = test;
      }
      if(line) lines.push(line);
      const totalH = (lines.length-1)*lineHeight;
      let startY = -totalH/2;
      for(const ln of lines){ ctx.fillText(ln, 0, startY); startY+=lineHeight; }
    }

    function draw(){
      drawBackground();
      drawItems();
    }

    // ====== Interaction (pointer) ======
    let dragging=false; let last={x:0,y:0};
    canvas.addEventListener('pointerdown', e=>{
      const p = getCanvasPoint(e);
      activeIndex = hitTest(p.x,p.y);
      if(activeIndex>-1){ dragging=true; last=p; canvas.setPointerCapture(e.pointerId); }
      draw();
    });
    canvas.addEventListener('pointermove', e=>{
      if(!dragging||activeIndex<0) return;
      const p = getCanvasPoint(e);
      const dx=p.x-last.x, dy=p.y-last.y;
      items[activeIndex].x += dx; items[activeIndex].y += dy; last=p; draw();
    });
    canvas.addEventListener('pointerup', e=>{ dragging=false; try{canvas.releasePointerCapture(e.pointerId)}catch{} });
    canvas.addEventListener('dblclick', ()=>{ activeIndex=-1; draw(); });

    // Keyboard helpers (desktop)
    window.addEventListener('keydown', e=>{
      if(activeIndex<0) return;
      const it=items[activeIndex];
      if(e.key==='a'||e.key==='A'){ it.rot-=0.05; draw(); }
      if(e.key==='d'||e.key==='D'){ it.rot+=0.05; draw(); }
      if(e.key==='w'||e.key==='W'){ it.scale=Math.min(3,(it.scale||1)+0.05); draw(); }
      if(e.key==='s'||e.key==='S'){ it.scale=Math.max(0.3,(it.scale||1)-0.05); draw(); }
      if(e.key==='Delete' || e.key==='Backspace'){ items.splice(activeIndex,1); activeIndex=-1; draw(); }
    });

    function getCanvasPoint(e){
      const r=canvas.getBoundingClientRect();
      const x = (e.clientX - r.left) * (canvas.width / r.width);
      const y = (e.clientY - r.top) * (canvas.height / r.height);
      return {x,y};
    }

    function hitTest(x,y){
      for(let i=items.length-1;i>=0;i--){
        const it=items[i];
        const dx = x - it.x, dy = y - it.y;
        if(Math.hypot(dx,dy) < 160) return i;
      }
      return -1;
    }

    // ====== Controls ======
    const textInput = document.getElementById('textInput');
    const textSize  = document.getElementById('textSize');
    document.getElementById('addText').onclick = ()=> addTextItem(textInput.value, parseInt(textSize.value,10));

    const stickerRow = document.getElementById('stickers');
    EMOJIS.forEach(em=>{
      const b=document.createElement('button'); b.className='btn sticker-btn'; b.textContent=em;
      b.onclick=()=>addSticker(em); stickerRow.appendChild(b);
    });
    document.getElementById('addRandomSticker').onclick = ()=> addSticker(EMOJIS[Math.floor(Math.random()*EMOJIS.length)]);

    document.getElementById('shuffleBg').onclick = ()=>{ bgIndex=(bgIndex+1)%BG_GRADIENTS.length; draw(); };
    document.getElementById('togglePattern').onclick = ()=>{ showPattern=!showPattern; draw(); };
    document.getElementById('centerAll').onclick = ()=>{
      const c=centerPos(); items.forEach(it=>{ it.x=c.x; it.y=c.y; }); draw();
    };
    document.getElementById('clearItems').onclick = ()=>{ items.length=0; activeIndex=-1; draw(); };

    document.getElementById('downloadBtn').onclick = ()=>{
      // ensure output is exactly 1080x1920 PNG
      const link = document.createElement('a');
      link.download = `postcard-${Date.now()}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    };

    // Live update current active text size if selected
    textSize.addEventListener('input', ()=>{
      if(activeIndex>-1 && items[activeIndex].type==='text'){
        items[activeIndex].size = parseInt(textSize.value,10); draw();
      }
    });

    // ====== Initial content ======
    addTextItem('‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å ‡πÜ ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞ üå∏', 64);
    addSticker('‚ú®'); addSticker('üêª');
    draw();
  </script>
</body>
</html>